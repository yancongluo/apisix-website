<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Apache APISIX® -- Cloud-Native API Gateway Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Apache APISIX® -- Cloud-Native API Gateway Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-WQLBQL6GY3"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-WQLBQL6GY3",{})</script>
<link rel="search" type="application/opensearchdescription+xml" title="Apache APISIX® -- Cloud-Native API Gateway" href="/opensearch.xml">
<link rel="alternate" type="application/rss+xml" href="/articles/rss.xml" title="Apache APISIX® -- Cloud-Native API Gateway Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/articles/atom.xml" title="Apache APISIX® -- Cloud-Native API Gateway Blog Atom Feed">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"><title data-react-helmet="true">Secure Exposure of Istio Services with APISIX Ingress | Apache APISIX® -- Cloud-Native API Gateway</title><meta data-react-helmet="true" property="og:image" content="https://apisix.apache.org/img/apache-apisix.png"><meta data-react-helmet="true" name="twitter:image" content="https://apisix.apache.org/img/apache-apisix.png"><meta data-react-helmet="true" property="og:url" content="https://apisix.apache.org/blog/2021/12/17/exposure-istio-with-apisix-ingress"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="default"><meta data-react-helmet="true" name="robots" content="index,follow"><meta data-react-helmet="true" name="twitter:card" content="summary"><meta data-react-helmet="true" property="og:title" content="Secure Exposure of Istio Services with APISIX Ingress | Apache APISIX® -- Cloud-Native API Gateway"><meta data-react-helmet="true" name="description" content="This article shows you step by step how to use Istio Service Mesh and Apache APISIX, to expose services in a Service Mesh-enabled Kubernetes cluster to the outside of the cluster through very detailed steps."><meta data-react-helmet="true" property="og:description" content="This article shows you step by step how to use Istio Service Mesh and Apache APISIX, to expose services in a Service Mesh-enabled Kubernetes cluster to the outside of the cluster through very detailed steps."><meta data-react-helmet="true" name="keywords" content="Apache APISIX,Istio,Kubernetes,APISIX Ingress Controller,Service Mesh"><meta data-react-helmet="true" property="og:type" content="article"><meta data-react-helmet="true" property="article:published_time" content="2021-12-17T00:00:00.000Z"><meta data-react-helmet="true" property="article:author" content="https://github.com/tao12345666333,https://github.com/SylviaBABY"><meta data-react-helmet="true" property="article:tag" content="Technology"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://apisix.apache.org/blog/2021/12/17/exposure-istio-with-apisix-ingress"><link data-react-helmet="true" rel="alternate" href="https://apisix.apache.org/blog/2021/12/17/exposure-istio-with-apisix-ingress" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://apisix.apache.org/zh/blog/2021/12/17/exposure-istio-with-apisix-ingress" hreflang="zh"><link data-react-helmet="true" rel="alternate" href="https://apisix.apache.org/blog/2021/12/17/exposure-istio-with-apisix-ingress" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://38VC84A2WJ-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/apache/apisix-website@asf-site/assets/css/styles.4ccf253e.css">
<link rel="preload" href="https://cdn.jsdelivr.net/gh/apache/apisix-website@asf-site/assets/js/runtime~main.29cc9d1a.js" as="script">
<link rel="preload" href="https://cdn.jsdelivr.net/gh/apache/apisix-website@asf-site/assets/js/main.41b511ad.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><div class="announcementBar_3WsW" style="background-color:#e8433e;color:white" role="banner"><div class="announcementBarPlaceholder_2m9F"></div><div class="announcementBarContent_3EUC">🤔 Have queries regarding apache APISIX, Join slack channel to discuss them <a target="_blank" rel="noopener noreferrer" href="https://apisix.apache.org/docs/general/community">join #apisix channel</a>! ⭐️</div><button type="button" class="clean-btn close announcementBarClose_38nx" aria-label="Close"><svg viewBox="0 0 24 24" width="14" height="14" fill="currentColor"><path d="M24 20.188l-8.315-8.209 8.2-8.282-3.697-3.697-8.212 8.318-8.31-8.203-3.666 3.666 8.321 8.24-8.206 8.313 3.666 3.666 8.237-8.318 8.285 8.203z"></path></svg></button></div><nav class="navbar navbar--fixed-top navbarHideable_2qcr"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo2.svg" alt="Apache APISIX®" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo2.svg" alt="Apache APISIX®" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Apache APISIX®</b></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" href="/docs">Docs</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/apisix/getting-started">Apache APISIX®️</a></li><li><a class="dropdown__link" href="/docs/dashboard/USER_GUIDE">Apache APISIX®️ Dashboard</a></li><li><a class="dropdown__link" href="/docs/ingress-controller/getting-started/">Apache APISIX®️ Ingress Controller</a></li><li><a class="dropdown__link" href="/docs/helm-chart/apisix/">Apache APISIX®️ Helm Charts</a></li><li><a class="dropdown__link" href="/docs/docker/build/">Apache APISIX®️ Docker</a></li><li><a class="dropdown__link" href="/docs/java-plugin-runner/development/">Apache APISIX®️ Java Plugin Runner</a></li><li><a class="dropdown__link" href="/docs/go-plugin-runner/getting-started/">Apache APISIX®️ Go Plugin Runner</a></li><li><a class="dropdown__link" href="/docs/python-plugin-runner/getting-started/">Apache APISIX®️ Python Plugin Runner</a></li><li><a class="dropdown__link" href="/docs/general/security">General</a></li></ul></div><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/downloads">Downloads</a><a class="navbar__item navbar__link" href="/help">Help</a><a class="navbar__item navbar__link" href="/team">Team</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link">Resources</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/showcase">Showcase</a></li><li><a class="dropdown__link" href="/plugins">Plugin Hub</a></li><li><a class="dropdown__link" href="/docs/general/community">Community</a></li><li><a class="dropdown__link" href="/contribute">Contribute</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" class="iconLanguage_3vod"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>English</span></span></a><ul class="dropdown__menu"><li><a href="/blog/2021/12/17/exposure-istio-with-apisix-ingress" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-transform:capitalize">English</a></li><li><a href="/zh/blog/2021/12/17/exposure-istio-with-apisix-ingress" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">简体中文</a></li></ul></div><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">🌞</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="searchBox_1Doo"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_2ahu thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_2hhb margin-bottom--md">All posts</div><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2022/01/04/authing">Using Apache APISIX and Authing to implement Centralized Authentication Management</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/12/30/apisix-proxy-grpc-service">Using the Apache APISIX proxy gRPC service</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/12/28/dashboard-cve-2021-45232">Apache APISIX Dashboard Unauthorized Access Vulnerability Announcement (CVE-2021-45232)</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/12/24/apisix-integrate-openwhisk-plugin">Coming soon! Apache APISIX Integrate with Apache OpenWhisk</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/12/24/open-policy-agent">Apache APISIX integrates with Open Policy Agent to enrich its ecosystem</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/12/22/google-logging">Apache APISIX Integrates with Google Cloud Logging to Improve Log Processing</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/12/20/weekly-report-1215">Biweekly Report｜12.1-12.15 Feature Highlights Update in Progress</a></li><li class="sidebarItem_2UVv"><a aria-current="page" class="sidebarItemLink_1RT6 sidebarItemLinkActive_12pM" href="/blog/2021/12/17/exposure-istio-with-apisix-ingress">Secure Exposure of Istio Services with APISIX Ingress</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/12/16/apisix-with-rocketmq-meetup">Webinar | Apache APISIX × Apache RocketMQ Online Meetup</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/12/15/deploy-apisix-in-kubernetes">How to Easily Deploy Apache APISIX in Kubernetes</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/12/13/monitor-apisix-ingress-controller-with-prometheus">Monitoring APISIX Ingress Controller with Prometheus</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/12/10/integrate-keycloak-auth-in-apisix">How to Integrate Keycloak for Authentication with Apache APISIX</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/12/08/apisix-integrate-rocketmq-logger-plugin">Apache APISIX &amp; RocketMQ Helps User API Log Monitoring Capabilities</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/12/07/apisix-integrate-skywalking-plugin">Apache APISIX Integrates with SkyWalking to Create a Full Fange of Log Processing</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/12/02/weekly-report-1130">Biweekly Report｜11.15-11.30 Feature Highlights Update in Progress</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/12/01/apisix-supports-azure-functions">Apache APISIX&#x27;s intergration with Azure Serverless</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/12/01/release-apache-apisix-2.11">Apache APISIX 2.11.0 is officially released with more new features</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/11/30/use-apisix-ingress-in-kubesphere">Using Apache APISIX Ingress Gateway to access Custom Monitoring in KubeSphere</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/11/26/apache-apisix-committer-experience">Contributer to Committer journey @Apache APISIX</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/11/23/cve-2021-43557-research-report">Apache APISIX request_uri variable is not properly controlled, with risk of path penetration</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/11/23/cve-2021-43557">Apache APISIX Path traversal in request_uri variable(CVE-2021-43557)</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/11/22/develop-apisix-ingress-with-nocalhost-in-kubernetes">Developing APISIX Ingress Controller with Nocalhost in Kubernetes</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/11/19/apisix-supports-wasm">Apache APISIX embraces the WASM ecosystem</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/11/17/dapr-with-apisix">How to integrate with Dapr to build Apache APISIX Gateway Controller</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/11/16/weekly-report-1114">Weekly Report｜11.1-11.14 Feature Highlights Update in Progress</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/11/12/apisix-datadog">Cloud Monitoring with Datadog in Apache APISIX</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/11/04/skywalking">The observability of Apache APISIX</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/11/03/airwallex-usercase">How Apache APISIX protects Airwallex data sovereignty through the gateway layer</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/11/02/weekly-report-1031">Weekly Report｜10.15-10.31 Feature Highlights Update in Progress</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/10/29/Extension-guide">Apache APISIX Extensions Guide</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/10/26/APISIX-Ingress">From 0 to 1, How APISIX Ingress Has Grown and Gained Since Joining The Community</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/10/22/cert-manager-in-ingress">Tutorial: How to use Cert Manager to manage certificates in Apache APISIX Ingress Controller</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/10/18/meetup">Webinar | Apache APISIX × Apache SkyWalking Online Meetup</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/10/14/weekly-report-1014">Community Weekly｜10.1-10.14 Feature Highlight Updates in Progress</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/10/13/celebrating-300-contributors-of-apisix">New milestone for the Apache APISIX community - over 300 contributors worldwide!</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/10/09/apisix-ingress-techblog">A thoughtful tutorial to get started with Apache APISIX Ingress from concept to practice</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/10/01/openEuler">Apache APISIX community members help openEuler release first community innovation version</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/09/30/weekly-report">Community Weekly｜New committer, feature highlight update in progress</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/09/29/release-apache-apisix-2.10">Release Apache APISIX 2.10.0</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/09/28/WPS-usercase">WPS has teamed up with Apache APISIX to create a new gateway experience</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/09/24/youpaicloud-usercase">Why is Apache APISIX Ingress a new option for building container gateways into the UPYUN?</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/09/18/xiaodian-usercase">Apache APISIX helps DIAN to facilitate cloud native solution</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/09/16/tencent-cloud">Implementing Apache APISIX in Tencent Cloud TI-ONE Platform</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/09/15/weekly-report">Community Weekly｜Two new committers, feature highlight updates in progress</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/09/14/youzan">Apache APISIX powers the Youzanyun native PaaS platform for comprehensive micro-service governance</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/09/13/china-mobile-cloud-usercase">How Apache APISIX is implemented in China Mobile Cloud</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/09/09/how-to-contribute-to-an-OpenSource-without-coding">How can I contribute to an open source project without writing code?</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/09/07/how-to-use-apisix-auth">Centralized Authentication with Apache APISIX and Advanced Tricks</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/09/07/iQIYI-usercase">Based on Apache APISIX, iQIYI API Gateway Update and landing practice</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/09/06/python-helps-you-quickly-with-Apache-APISIX-development">Python helps you develop Apache APISIX plugin</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/31/Apache APISIX × KubeSphere-a-better-gateway-and-K8S-Ingress-Controller">Apache APISIX × KubeSphere: Providing a better gateway and K8S Ingress Controller</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/30/Ingress-Meeting">Webinar｜ See you at the Apache APISIX Ingress Community Meeting on Wednesday at 2pm!</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/30/weekly-report">Apache APISIX Community Weekly Report ｜ 2021 8.23-8.29</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/27/release-apache-apisix-2.9">Release Apache APISIX 2.9</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/25/Auth-with-Casbin-in-Apache-APISIX">Authorization with Casbin in Apache APISIX</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/25/Using-the-Apache-APISIX-OpenID-Connect-Plugin-for-Centralized-Authentication">Centralized authentication using the OpenID Connect plug-in for Apache APISIX</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/25/Why-Apache-APISIX-chose-Nginx-and-Lua">Why Apache APISIX chose Nginx and Lua to build API Gateway</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/24/shanghai-meetup-recap">Apache APISIX Meetup in Shanghai</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/23/ApacheCon-Asia-2021">ApacheCon Asia 2021</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/23/weekly-report">Apache APISIX 社区周报 ｜ 2021 8.16-8.22</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/21/shanghai-meetup">August 21 Apache APISIX Meetup Shanghai, welcome to register!</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/19/go-makes-Apache-APISIX-better">Go gives Apache APISIX a run for its money</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/19/weekly-report">Apache APISIX 社区周报 ｜ 08-09 ～ 08-15</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/18/Auth-with-Casbin-in-Apache-APISIX">Licensing with Casbin in Apache APISIX</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/17/interview-airwallex">Apache APISIX in Airwallex | Interview with Yang Li, Head of Airwallex Technology Platform</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/16/Using-the-Apache-APISIX-OpenID-Connect-Plugin-for-Centralized-Authentication">Using the Apache APISIX OpenID Connect Plugin for Okta Centralized Authentication</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/14/contributors-the-golden-metric-of-openSource-projects">Contributors — The Golden Metric of OpenSource Projects</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/12/Chaos-Mesh-Helps-Apache-APISIX-Improve-System-Stability">Chaos Mesh Helps Apache APISIX Improve System Stability</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/11/interview-TuZhengsong">I issued my first PR in the Apache APISIX community</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/10/apisix-nginx">Apache APISIX Architecture Analysis: How to Dynamically Manage Nginx Clustering?</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/09/Apache-APISIX-in-China-Mobile-Cloud">Apache APISIX 在移动云的应用</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/09/Apache-APISIX-in-Quliankeji">Abandoning Kong and Nginx, Hyperchain Technology implements on its BaaS platform</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/06/using-apache-apisix-to-improve-the-observability-of-nginx">How to Improve the Observability of Nginx with Apache APISX</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/08/05/Kong-to-APISIX">Kong-To-APISIX Migration Tool</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/07/28/release-apache-apisix-2.8">Release Apache APISIX 2.8.0</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/07/27/use-of-plugin-orchestration-in-Apache-APISIX">Applying Plugin Orchestration in Apache APISIX</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/07/25/apachecon-asia">ApacheCon Asia 2021: Apache APISIX Technical Topics</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/07/21/Apache-APISIX-Kubernetes">Apache APISIX x Kubernetes: Just Right｜Live</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/07/14/the-road-to-customization-of-Sina-Weibo-API-gateway-based-on-Apache-APISIX">The Road to Customized Development of Sina Weibo API Gateway</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/07/06/celebrate-200-contributors">Apache APISIX has over 200 contributors in GitHub main repo! </a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/06/30/etcd3-support-HTTP-access-perfectly">Does etcd 3 Support HTTP Access Perfectly?</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/06/29/release-apache-apisix-2.7">Release Apache APISIX 2.7.0</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/06/28/why-we-need-Apache-APISIX">Why do you need Apache APISIX when you have NGINX and Kong?</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/06/23/deploy-great-open-source-gateway-and-ingress-controller-fast">Deploy Apache APISIX and Apache APISIX Ingress Controller on Rancher</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/06/21/use-Java-to-write-Apache-APISIX-plugins">How to Write an Apache APISIX Plugin in Java</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/06/18/first-GA-version-v1.0-of-Apache-APISIX-Ingress-Controller-released">The first GA release of Apache APISIX Ingress Controller v1.0 is now available!</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/06/17/Apache-APISIX-Dashboard-Access-Control-Bypass-Vulnerability-Announcement">Apache APISIX Dashboard Access Control Bypass Vulnerability Advisory (CVE-2021-33190)</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/06/16/Chaos-Mesh-helps-Apache-APISIX-improve-stability">Chaos Mesh Helps Apache APISIX Improve Stability</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/06/10/Apache-APISIX-and-Envoy-performance-comparison">Apache APISIX v.s Envoy: Which Has the Better Performance?</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/06/07/Apache-APISIX-not-affected-by-NGINX-CVE-2021-23017">Apache APISIX not affected by NGINX CVE-2021-23017</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/06/06/apisix-two-years">Apache APISIX Open Source 2 Year Anniversary!</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/06/03/experience-share-from-Apache-APISIX-committer">Experience sharing from Apache APISIX committer - Interview with Summer of Programming</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/05/25/Apache APISIX 2.6.0-Release">Apache APISIX 2.6.0-Release Officially Released</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/05/24/Tencent-Games">How to use API Gateway to process 1 billion traffic daily for Tencent?</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/03/02/get-front-end-test-coverage-with-cypress">Get Front-End Test Coverage with Cypress</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/02/26/install-apache-apisix-from-helm-charts">Install Apache APISIX from Helm Charts</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/02/08/stable-product-delivery-with-cypress">Stable Product Delivery with Cypress</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/01/21/run-ingress-apisix-on-amazon-eks">Run Ingress APISIX on Amazon EKS</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/01/11/interview-Apache-APISIX-contributor-Wang-Pengcheng-Senior-Security-Advisor-of-PwC-South-China-Data-Security-and-Privacy-Protection-Team">Apache APISIX Contributor Interview | Pengcheng Wang, Senior Security Consultant, PricewaterhouseCoopers China Data Security &amp; Privacy Team</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/12/18/first-look-at-kubernetes-service-api">A First Look at Kubernetes Service APIs</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/12/16/another-way-to-implement-envoy-filter">Envoy and Apache APISIX: Another way to implement the Envoy filter</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/12/11/beike-how-to-build-gateway-based-on-apache-apisix">贝壳找房：如何基于 Apache APISIX 搭建网关</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="blogPostTitle_GeHD" itemprop="headline">Secure Exposure of Istio Services with APISIX Ingress</h1><div class="blogPostData_291c margin-vert--md"><time datetime="2021-12-17T00:00:00.000Z" itemprop="datePublished">December 17, 2021</time> · 9 min read</div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_1R69"><div class="avatar margin-bottom--sm"><a href="https://github.com/tao12345666333" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_1yU8" src="https://avatars.githubusercontent.com/u/3264292?v=4" alt="Jintao Zhang"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/tao12345666333" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Jintao Zhang</span></a></div><small class="avatar__subtitle" itemprop="description">Author</small></div></div></div><div class="col col--6 authorCol_1R69"><div class="avatar margin-bottom--sm"><a href="https://github.com/SylviaBABY" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_1yU8" src="https://avatars.githubusercontent.com/u/39793568?v=4" alt="Sylvia"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/SylviaBABY" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Sylvia</span></a></div><small class="avatar__subtitle" itemprop="description">Technical Writer</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><blockquote><p>This article shows you step by step how to use Istio Service Mesh and Apache APISIX, to expose services in a Service Mesh-enabled Kubernetes cluster to the outside of the cluster through very detailed steps.</p></blockquote><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="service-mesh"></a>Service Mesh<a class="hash-link" href="#service-mesh" title="Direct link to heading">#</a></h2><p>With the hot development of Cloud-Native technology, Service Mesh is gradually becoming popular in the microservices field. The popular implementations of Service Mesh are <a href="https://istio.io/" target="_blank" rel="noopener noreferrer">Istio</a> and <a href="https://linkerd.io/" target="_blank" rel="noopener noreferrer">Linkerd</a>.</p><p>The following diagram shows the schematic diagram of Service Mesh, which introduces Sidecar Proxy to complete the interconnection and communication between microservices.</p><p><img src="https://static.apiseven.com/202108/1639730484170-fbf2e5ed-3041-4975-8730-a16c92be68f2.png" alt="Service Mesh"></p><p>The diagram above shows that Service Mesh focuses more on east-west traffic in the traditional sense, i.e., traffic between services. When we use Service Mesh with Kubernetes, the east-west traffic corresponds to the traffic within the Kubernetes cluster.</p><p>Back in real-world usage scenarios, we won&#x27;t only be exposed to traffic within the Kubernetes cluster, we will mostly need to expose some services outside of the cluster for users or other services to use. But when exposing services in a Kubernetes cluster outside the cluster, we have to consider factors such as security and observability.</p><p>We&#x27;ll show you how to securely expose services in a Service Mesh-enabled Kubernetes cluster outside the cluster using Istio Service Mesh and Apache APISIX.</p><p><img src="https://static.apiseven.com/202108/1639730236819-0911b90b-811f-4451-b0e5-f89ac3e04b77.png" alt="How to deal"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="step-1-prepare-the-kubernetes-cluster"></a>Step 1: Prepare the Kubernetes cluster<a class="hash-link" href="#step-1-prepare-the-kubernetes-cluster" title="Direct link to heading">#</a></h2><p>Here we use <a href="https://github.com/kubernetes-sigs/kind/" target="_blank" rel="noopener noreferrer">Kind</a> to create a temporary cluster locally for demonstration purposes. You can refer to the <a href="https://kind.sigs.k8s.io/docs/user/quick-start/#installation" target="_blank" rel="noopener noreferrer">official documentation</a> for how to install it with the Kind command.</p><p>Here is the yaml configuration file used to create the demo cluster, save it as <code>kind-config.yaml</code>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Cluster</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kind.x</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">k8s.io/v1alpha4</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">nodes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">role</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> control</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">plane</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">role</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> worker</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">role</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> worker</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">role</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> worker</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Then use this configuration file to create a cluster.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">MoeLove</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> ➜ kind create cluster --config kind-config.yaml</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Creating cluster </span><span class="token string" style="color:#e3116c">&quot;kind&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> ✓ Ensuring node image </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">kindest/node:v1.22.2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> 🖼</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> ✓ Preparing nodes 📦 📦 📦 📦  </span></span><span class="token-line" style="color:#393A34"><span class="token plain"> ✓ Writing configuration 📜</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> ✓ Starting control-plane 🕹️</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> ✓ Installing CNI 🔌</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> ✓ Installing StorageClass 💾</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> ✓ Joining worker nodes 🚜</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Set kubectl context to </span><span class="token string" style="color:#e3116c">&quot;kind-kind&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">You can now use your cluster with:</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl cluster-info --context kind-kind</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Not sure what to </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"> next? 😅  Check out https://kind.sigs.k8s.io/docs/user/quick-start/</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="step-2-deploy-istio"></a>Step 2: Deploy Istio<a class="hash-link" href="#step-2-deploy-istio" title="Direct link to heading">#</a></h2><p>After the Kubernetes cluster is created, let&#x27;s deploy Istio.</p><p>First, create a directory named <code>apisix-istio</code> and do the following after entering the directory.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">MoeLove</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> ➜ </span><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> apisix-istio</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">MoeLove</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> ➜ </span><span class="token builtin class-name">cd</span><span class="token plain"> apisix-istio</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">MoeLove</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> ➜ </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> -sL https://istio.io/downloadIstio </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sh</span><span class="token plain"> -</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Downloading istio-1.12.1 from https://github.com/istio/istio/releases/download/1.12.1/istio-1.12.1-linux-amd64.tar.gz </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Istio </span><span class="token number" style="color:#36acaa">1.12</span><span class="token plain">.1 Download Complete</span><span class="token operator" style="color:#393A34">!</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Istio has been successfully downloaded into the istio-1.12.1 folder on your system.</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Next Steps:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">See https://istio.io/latest/docs/setup/install/ to </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> Istio to your Kubernetes cluster.</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">To configure the istioctl client tool </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> your workstation,</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> the /root/apisix-istio/istio-1.12.1/bin directory to your environment path variable with:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable environment constant" style="color:#36acaa">PATH</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string environment constant" style="color:#36acaa">$PATH</span><span class="token string" style="color:#e3116c">:/root/apisix-istio/istio-1.12.1/bin&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Begin the Istio pre-installation check by running:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">         istioctl x precheck</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Need </span><span class="token function" style="color:#d73a49">more</span><span class="token plain"> information? Visit https://istio.io/latest/docs/setup/install/</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>When the above operation is completed, a new directory will be created under the current directory. We can follow the output of the above command to continue the operation.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">MoeLove</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> ➜ </span><span class="token function" style="color:#d73a49">ls</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">istio-1.12.1</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">MoeLove</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> ➜ </span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable environment constant" style="color:#36acaa">PATH</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string environment constant" style="color:#36acaa">$PATH</span><span class="token string" style="color:#e3116c">:/root/apisix-istio/istio-1.12.1/bin&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">MoeLove</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> ➜ istioctl x precheck</span></span><span class="token-line" style="color:#393A34"><span class="token plain">✔ No issues found when checking the cluster. Istio is safe to </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> or upgrade</span><span class="token operator" style="color:#393A34">!</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  To get started, check out https://istio.io/latest/docs/setup/getting-started/</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Next, the real deployment process begins. Just set it to <code>--set profile=minimal</code> for a minimal installation.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">MoeLove</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> ➜ istioctl </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> --set </span><span class="token assign-left variable" style="color:#36acaa">profile</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">minimal  -y</span></span><span class="token-line" style="color:#393A34"><span class="token plain">✔ Istio core</span></span><span class="token-line" style="color:#393A34"><span class="token plain">installed</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">✔ Istiod</span></span><span class="token-line" style="color:#393A34"><span class="token plain">installed</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">✔ Installation</span></span><span class="token-line" style="color:#393A34"><span class="token plain">complete</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Making this installation the default </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> injection and validation.</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Thank you </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> installing Istio </span><span class="token number" style="color:#36acaa">1.12</span><span class="token plain">.  Please take a few minutes to tell us about your install/upgrade experience</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">  https://forms.gle/FegQbc9UvePd4Z9z7</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Finally, check the current deployment status and you can see that the Pod is already running.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">MoeLove</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> ➜ kubectl -n istio-system get pods</span></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                      READY   STATUS    RESTARTS   AGE</span></span><span class="token-line" style="color:#393A34"><span class="token plain">istiod-58d79b7bff-g66cv   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          1m</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="step-3-deploy-apache-apisix"></a>Step 3: Deploy Apache APISIX<a class="hash-link" href="#step-3-deploy-apache-apisix" title="Direct link to heading">#</a></h2><p>Next, we will deploy Apache APISIX.</p><p>First create a Namespace named <code>apisix-istio</code> and enable auto-injection.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">MoeLove</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> ➜ kubectl create ns apisix-istio</span></span><span class="token-line" style="color:#393A34"><span class="token plain">namespace/apisix-istio created</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">MoeLove</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> ➜ kubectl label namespace apisix-istio istio-injection</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">enabled</span></span><span class="token-line" style="color:#393A34"><span class="token plain">namespace/apisix-istio labeled</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Next, add Helm Repo and use Helm for Apache APISIX and Apache APISIX Ingress Controller deployments.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">MoeLove</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> ➜ helm repo </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> apisix https://charts.apiseven.com</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token string" style="color:#e3116c">&quot;apisix&quot;</span><span class="token plain"> has been added to your repositories</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">MoeLove</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> ➜ helm </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> apisix-istio apisix/apisix --set gateway.type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">NodePort --set ingress-controller.enabled</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true --set ingress-controller.config.apisix.serviceNamespace</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">apisix-istio  --set ingress-controller.config.apisix.serviceName</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">apisix-istio-admin  --namespace apisix-istio</span></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME: apisix-istio</span></span><span class="token-line" style="color:#393A34"><span class="token plain">LAST DEPLOYED: Wed Dec </span><span class="token number" style="color:#36acaa">15</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">14</span><span class="token plain">:16:33 </span><span class="token number" style="color:#36acaa">2021</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">NAMESPACE: apisix-istio</span></span><span class="token-line" style="color:#393A34"><span class="token plain">STATUS: deployed</span></span><span class="token-line" style="color:#393A34"><span class="token plain">REVISION: </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">TEST SUITE: None</span></span><span class="token-line" style="color:#393A34"><span class="token plain">NOTES:</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">1</span><span class="token plain">. Get the application URL by running these commands:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">NODE_PORT</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable" style="color:#36acaa">kubectl get --namespace apisix-istio -o </span><span class="token variable assign-left variable" style="color:#36acaa">jsonpath</span><span class="token variable operator" style="color:#393A34">=</span><span class="token variable string" style="color:#e3116c">&quot;{.spec.ports[0].nodePort}&quot;</span><span class="token variable" style="color:#36acaa"> services apisix-istio-gateway</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">NODE_IP</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable" style="color:#36acaa">kubectl get nodes --namespace apisix-istio -o </span><span class="token variable assign-left variable" style="color:#36acaa">jsonpath</span><span class="token variable operator" style="color:#393A34">=</span><span class="token variable string" style="color:#e3116c">&quot;{.items[0].status.addresses[0].address}&quot;</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token builtin class-name">echo</span><span class="token plain"> http://</span><span class="token variable" style="color:#36acaa">$NODE_IP</span><span class="token builtin class-name">:</span><span class="token variable" style="color:#36acaa">$NODE_PORT</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>After executing the above command, you can wait for all Pods to run normally by executing the following command.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">MoeLove</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> ➜ kubectl -n apisix-istio </span><span class="token function" style="color:#d73a49">wait</span><span class="token plain"> --for</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">condition</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">Ready pods --all</span></span><span class="token-line" style="color:#393A34"><span class="token plain">pod/apisix-istio-7bdfcb4bd9-89jcn condition met</span></span><span class="token-line" style="color:#393A34"><span class="token plain">pod/apisix-istio-etcd-0 condition met</span></span><span class="token-line" style="color:#393A34"><span class="token plain">pod/apisix-istio-etcd-1 condition met</span></span><span class="token-line" style="color:#393A34"><span class="token plain">pod/apisix-istio-etcd-2 condition met</span></span><span class="token-line" style="color:#393A34"><span class="token plain">pod/apisix-istio-ingress-controller-5fcbb75b8c-b4nnc condition met</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>You can see that all the Pods are currently running properly. Next, let&#x27;s test and verify.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="test-session"></a>Test Session<a class="hash-link" href="#test-session" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="simple-test"></a>Simple test<a class="hash-link" href="#simple-test" title="Direct link to heading">#</a></h3><p>When we deployed Apache APISIX using Helm earlier, we selected the service exposure method as <code>NodePort</code>, so we can then access Apache APISIX directly using the following command.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">MoeLove</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> ➜ </span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">NODE_PORT</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable" style="color:#36acaa">kubectl get --namespace apisix-istio -o </span><span class="token variable assign-left variable" style="color:#36acaa">jsonpath</span><span class="token variable operator" style="color:#393A34">=</span><span class="token variable string" style="color:#e3116c">&quot;{.spec.ports[0].nodePort}&quot;</span><span class="token variable" style="color:#36acaa"> services apisix-istio-gateway</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">MoeLove</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> ➜ </span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">NODE_IP</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable" style="color:#36acaa">kubectl get nodes --namespace apisix-istio -o </span><span class="token variable assign-left variable" style="color:#36acaa">jsonpath</span><span class="token variable operator" style="color:#393A34">=</span><span class="token variable string" style="color:#e3116c">&quot;{.items[0].status.addresses[0].address}&quot;</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">MoeLove</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> ➜ </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> http://</span><span class="token variable" style="color:#36acaa">$NODE_IP</span><span class="token builtin class-name">:</span><span class="token variable" style="color:#36acaa">$NODE_PORT</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;error_msg&quot;</span><span class="token builtin class-name">:</span><span class="token string" style="color:#e3116c">&quot;404 Route Not Found&quot;</span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Note that when requesting with the <code>curl</code> command we add a <code>-v</code> option to look at the response headers of the request.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">MoeLove</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> ➜ </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> -v http://</span><span class="token variable" style="color:#36acaa">$NODE_IP</span><span class="token builtin class-name">:</span><span class="token variable" style="color:#36acaa">$NODE_PORT</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">* Rebuilt URL to: http://172.20.0.2:31225/</span></span><span class="token-line" style="color:#393A34"><span class="token plain">*   Trying </span><span class="token number" style="color:#36acaa">172.20</span><span class="token plain">.0.2</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span></span><span class="token-line" style="color:#393A34"><span class="token plain">* TCP_NODELAY </span><span class="token builtin class-name">set</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">* Connected to </span><span class="token number" style="color:#36acaa">172.20</span><span class="token plain">.0.2 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">172.20</span><span class="token plain">.0.2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> port </span><span class="token number" style="color:#36acaa">31225</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token comment" style="color:#999988;font-style:italic">#0)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> GET / HTTP/1.1</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> Host: </span><span class="token number" style="color:#36acaa">172.20</span><span class="token plain">.0.2:31225</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> User-Agent: curl/7.58.0</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> Accept: */*</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> HTTP/1.1 </span><span class="token number" style="color:#36acaa">404</span><span class="token plain"> Not Found</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> date: Wed, </span><span class="token number" style="color:#36acaa">15</span><span class="token plain"> Dec </span><span class="token number" style="color:#36acaa">2021</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">14</span><span class="token plain">:31:40 GMT</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> content-type: text/plain</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">charset</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">utf-8</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> server: istio-envoy</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> x-envoy-upstream-service-time: </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> x-envoy-decorator-operation: apisix-istio-gateway.apisix-istio.svc.cluster.local:80/*</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> transfer-encoding: chunked</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;error_msg&quot;</span><span class="token builtin class-name">:</span><span class="token string" style="color:#e3116c">&quot;404 Route Not Found&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">* Connection </span><span class="token comment" style="color:#999988;font-style:italic">#0 to host 172.20.0.2 left intact</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>As you can see from the above output, the response header contains the following.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> server: istio-envoy</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> x-envoy-upstream-service-time: </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> x-envoy-decorator-operation: apisix-istio-gateway.apisix-istio.svc.cluster.local:80/*</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>This means that Istio&#x27;s auto-injection has succeeded, and that it is not Apache APISIX but Istio&#x27;s Sidecar that is currently interacting directly.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_3R7-" id="bookinfo-deployment-testing"></a>BookInfo Deployment Testing<a class="hash-link" href="#bookinfo-deployment-testing" title="Direct link to heading">#</a></h3><p>Next, we use Istio&#x27;s own BookInfo sample application to perform the relevant tests.</p><p>First, create a Namespace and enable Istio&#x27;s auto-injection.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">MoeLove</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> ➜ kubectl create ns bookinfo</span></span><span class="token-line" style="color:#393A34"><span class="token plain">namespace/bookinfo created</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">MoeLove</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> ➜ kubectl label namespace bookinfo istio-injection</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">enabled</span></span><span class="token-line" style="color:#393A34"><span class="token plain">namespace/bookinfo labeled</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>BookInfo deployment is then performed and the relevant deployment files are automatically created in the directory during the above-mentioned Istio installation.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">MoeLove</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> ➜ kubectl -n bookinfo apply -f istio-1.12.1/samples/bookinfo/platform/kube/bookinfo.yaml</span></span><span class="token-line" style="color:#393A34"><span class="token plain">service/details created</span></span><span class="token-line" style="color:#393A34"><span class="token plain">serviceaccount/bookinfo-details created</span></span><span class="token-line" style="color:#393A34"><span class="token plain">deployment.apps/details-v1 created</span></span><span class="token-line" style="color:#393A34"><span class="token plain">service/ratings created</span></span><span class="token-line" style="color:#393A34"><span class="token plain">serviceaccount/bookinfo-ratings created</span></span><span class="token-line" style="color:#393A34"><span class="token plain">deployment.apps/ratings-v1 created</span></span><span class="token-line" style="color:#393A34"><span class="token plain">service/reviews created</span></span><span class="token-line" style="color:#393A34"><span class="token plain">serviceaccount/bookinfo-reviews created`</span></span><span class="token-line" style="color:#393A34"><span class="token plain">deployment.apps/reviews-v1 created</span></span><span class="token-line" style="color:#393A34"><span class="token plain">deployment.apps/reviews-v2 created</span></span><span class="token-line" style="color:#393A34"><span class="token plain">deployment.apps/reviews-v3 created</span></span><span class="token-line" style="color:#393A34"><span class="token plain">service/productpage created</span></span><span class="token-line" style="color:#393A34"><span class="token plain">serviceaccount/bookinfo-productpage created</span></span><span class="token-line" style="color:#393A34"><span class="token plain">deployment.apps/productpage-v1 created</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Wait for all Pods to run normally.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">MoeLove</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> ➜ kubectl -n bookinfo get pods</span></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                             READY   STATUS    RESTARTS   AGE</span></span><span class="token-line" style="color:#393A34"><span class="token plain">details-v1-96cf758d8-qr6p9       </span><span class="token number" style="color:#36acaa">2</span><span class="token plain">/2     Running   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          64s</span></span><span class="token-line" style="color:#393A34"><span class="token plain">productpage-v1-5f75dfbfb-22hcw   </span><span class="token number" style="color:#36acaa">2</span><span class="token plain">/2     Running   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          64s</span></span><span class="token-line" style="color:#393A34"><span class="token plain">ratings-v1-779dbc4fdd-jt5zp      </span><span class="token number" style="color:#36acaa">2</span><span class="token plain">/2     Running   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          64s</span></span><span class="token-line" style="color:#393A34"><span class="token plain">reviews-v1-ffbbf7fc8-kxvrr       </span><span class="token number" style="color:#36acaa">2</span><span class="token plain">/2     Running   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          64s</span></span><span class="token-line" style="color:#393A34"><span class="token plain">reviews-v2-54546c6f84-pnjkn      </span><span class="token number" style="color:#36acaa">2</span><span class="token plain">/2     Running   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          64s</span></span><span class="token-line" style="color:#393A34"><span class="token plain">reviews-v3-74d6bf84cd-h4r9z      </span><span class="token number" style="color:#36acaa">2</span><span class="token plain">/2     Running   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          63s</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Now we can use Apache APISIX to expose the service outside the Kubernetes cluster. Create a routing configuration using the following and save it as <code>productpage-ar.yaml</code>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apisix.apache.org/v2beta2</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ApisixRoute</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> productpage</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> rule1</span></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token key atrule" style="color:#00a4db">match</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token key atrule" style="color:#00a4db">hosts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> apisix</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">istio.dev</span></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token key atrule" style="color:#00a4db">paths</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> /*</span></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token key atrule" style="color:#00a4db">backends</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">serviceName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> productpage</span></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token key atrule" style="color:#00a4db">servicePort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">9080</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>The above configuration can be interpreted as creating a route with the domain name <code>apisix-istio.dev</code> and forwarding all request traffic to port <code>9080</code> of the <code>productpage</code> service.</p></div></div><p>Then create this resource.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">MoeLove</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> ➜ kubectl -n bookinfo apply -f productpage-ar.yaml</span></span><span class="token-line" style="color:#393A34"><span class="token plain">apisixroute.apisix.apache.org/productpage created</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Request Apache APISIX again with the domain name we just configured, and you will see that a <code>200</code> related prompt is returned.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">MoeLove</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> ➜ </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> -I -H </span><span class="token string" style="color:#e3116c">&quot;HOST: apisix-istio.dev&quot;</span><span class="token plain"> http://</span><span class="token variable" style="color:#36acaa">$NODE_IP</span><span class="token builtin class-name">:</span><span class="token variable" style="color:#36acaa">$NODE_PORT</span><span class="token plain">/</span></span><span class="token-line" style="color:#393A34"><span class="token plain">HTTP/1.1 </span><span class="token number" style="color:#36acaa">200</span><span class="token plain"> OK</span></span><span class="token-line" style="color:#393A34"><span class="token plain">content-type: text/html</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">charset</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">utf-8</span></span><span class="token-line" style="color:#393A34"><span class="token plain">content-length: </span><span class="token number" style="color:#36acaa">1683</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">date: Wed, </span><span class="token number" style="color:#36acaa">15</span><span class="token plain"> Dec </span><span class="token number" style="color:#36acaa">2021</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">15</span><span class="token plain">:47:30 GMT</span></span><span class="token-line" style="color:#393A34"><span class="token plain">x-envoy-upstream-service-time: </span><span class="token number" style="color:#36acaa">7</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">server: istio-envoy</span></span><span class="token-line" style="color:#393A34"><span class="token plain">x-envoy-decorator-operation: apisix-istio-gateway.apisix-istio.svc.cluster.local:80/*</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The Apache APISIX port can then be exposed via <code>port-forward</code>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">MoeLove</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> ➜ kubectl -n apisix-istio port-forward --address </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">.0.0 svc/apisix-istio-gateway </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain">:80</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Forwarding from </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">.0.0:8080 -</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">9080</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Finally, set the Header of <code>HOST: apisix-istio.dev</code> in your browser and try to make a request, you will get the correct page as shown below.</p><p><img src="https://static.apiseven.com/202108/1639713895938-dec7460b-fa51-443e-a32e-fe2000788127.png" alt="Correct page"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="visualization-tool-kiali"></a>Visualization tool: Kiali<a class="hash-link" href="#visualization-tool-kiali" title="Direct link to heading">#</a></h2><p>Kiali is a tool that allows visualization of Istio and can be installed as an Istio add-on.</p><p>It is deployed here directly using the configuration files in the <code>addons</code> directory carried by Istio.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">MoeLove</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> ➜ kubectl -n istio-system apply -f  istio-1.12.1/samples/addons/</span></span><span class="token-line" style="color:#393A34"><span class="token plain">serviceaccount/grafana created</span></span><span class="token-line" style="color:#393A34"><span class="token plain">configmap/grafana created</span></span><span class="token-line" style="color:#393A34"><span class="token plain">service/grafana created</span></span><span class="token-line" style="color:#393A34"><span class="token plain">deployment.apps/grafana created</span></span><span class="token-line" style="color:#393A34"><span class="token plain">configmap/istio-grafana-dashboards created</span></span><span class="token-line" style="color:#393A34"><span class="token plain">configmap/istio-services-grafana-dashboards created</span></span><span class="token-line" style="color:#393A34"><span class="token plain">deployment.apps/jaeger created</span></span><span class="token-line" style="color:#393A34"><span class="token plain">service/tracing created</span></span><span class="token-line" style="color:#393A34"><span class="token plain">service/zipkin created</span></span><span class="token-line" style="color:#393A34"><span class="token plain">service/jaeger-collector created</span></span><span class="token-line" style="color:#393A34"><span class="token plain">serviceaccount/kiali created</span></span><span class="token-line" style="color:#393A34"><span class="token plain">configmap/kiali created</span></span><span class="token-line" style="color:#393A34"><span class="token plain">clusterrole.rbac.authorization.k8s.io/kiali-viewer created</span></span><span class="token-line" style="color:#393A34"><span class="token plain">clusterrole.rbac.authorization.k8s.io/kiali created</span></span><span class="token-line" style="color:#393A34"><span class="token plain">clusterrolebinding.rbac.authorization.k8s.io/kiali created</span></span><span class="token-line" style="color:#393A34"><span class="token plain">role.rbac.authorization.k8s.io/kiali-controlplane created</span></span><span class="token-line" style="color:#393A34"><span class="token plain">rolebinding.rbac.authorization.k8s.io/kiali-controlplane created</span></span><span class="token-line" style="color:#393A34"><span class="token plain">service/kiali created</span></span><span class="token-line" style="color:#393A34"><span class="token plain">deployment.apps/kiali created</span></span><span class="token-line" style="color:#393A34"><span class="token plain">serviceaccount/prometheus created</span></span><span class="token-line" style="color:#393A34"><span class="token plain">configmap/prometheus created</span></span><span class="token-line" style="color:#393A34"><span class="token plain">clusterrole.rbac.authorization.k8s.io/prometheus created</span></span><span class="token-line" style="color:#393A34"><span class="token plain">clusterrolebinding.rbac.authorization.k8s.io/prometheus created</span></span><span class="token-line" style="color:#393A34"><span class="token plain">service/prometheus created</span></span><span class="token-line" style="color:#393A34"><span class="token plain">deployment.apps/prometheus created</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Wait for the normal operation of Pod to view:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">MoeLove</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> ➜ kubectl -n istio-system get pods</span></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                          READY   STATUS    RESTARTS   AGE</span></span><span class="token-line" style="color:#393A34"><span class="token plain">grafana-6ccd56f4b6-wq6k5      </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          2m12s</span></span><span class="token-line" style="color:#393A34"><span class="token plain">istiod-58d79b7bff-g66cv       </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          42m</span></span><span class="token-line" style="color:#393A34"><span class="token plain">jaeger-5d44bc5c5d-84ksf       </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          2m11s</span></span><span class="token-line" style="color:#393A34"><span class="token plain">kiali-79b86ff5bc-w457g        </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          2m3s</span></span><span class="token-line" style="color:#393A34"><span class="token plain">prometheus-64fd8ccd65-2mjcc   </span><span class="token number" style="color:#36acaa">2</span><span class="token plain">/2     Running   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          2m9s</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Next, execute the following command to port-forward Kiali and access it in the browser. Of course, you can do the same thing with the above port-forward.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">MoeLove</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> ➜ istioctl dashboard kiali  --address </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">.0.0 --port </span><span class="token number" style="color:#36acaa">9999</span><span class="token plain"> --browser</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">false</span></span><span class="token-line" style="color:#393A34"><span class="token plain">http://0.0.0.0:9999/kiali</span></span><span class="token-line" style="color:#393A34"><span class="token plain">skipping opening a browser</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Open <code>http://0.0.0.0:9999/kiali</code> in your browser and try to access the BookInfo service via Apache APISIX several times to see the following results.</p><p><img src="https://static.apiseven.com/202108/1639714083338-d5a0601e-5dcb-446d-9b25-89ec95044ebd.png" alt="Access BookInfo"></p><p>Click Graph and select Namespace as BookInfo. During the test to access the BookInfo application, you can see the effect shown below. You can see the traffic coming in from the Apache APISIX and then flowing to the various components of the application.</p><p><img src="https://static.apiseven.com/202108/1639714198376-27882a16-751b-436d-9212-69cad379bb72.png" alt="Flow chart"></p><p>This concludes the entire process. We have successfully exposed the services in the Kubernetes cluster with Service Mesh enabled using Apache APISIX and Apache APISIX Ingress Controller securely.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_3R7-" id="summary"></a>Summary<a class="hash-link" href="#summary" title="Direct link to heading">#</a></h2><p>This article shows you step-by-step how to use Istio Service Mesh and Apache APISIX to expose the services in a Service Mesh-enabled Kubernetes cluster to the outside of the cluster in a very detailed step-by-step manner. You can also provide more security or traffic control through the rich plug-in capabilities of Apache APISIX in the future.</p><p>We hope that the above detailed tutorials will help you to more easily integrate with solutions such as Istio when using Apache APISIX.</p></div><footer class="row docusaurus-mt-lg blogPostDetailsFull_3kfx"><div class="col"><b>Tags:</b><ul class="tags_2ga9 padding--none margin-left--sm"><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/blog/tags/technology">Technology</a></li></ul></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/blog/2021/12/20/weekly-report-1215"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">« Biweekly Report｜12.1-12.15 Feature Highlights Update in Progress</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/2021/12/16/apisix-with-rocketmq-meetup"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Webinar | Apache APISIX × Apache RocketMQ Online Meetup »</div></a></div></nav></main><div class="col col--2"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#service-mesh" class="table-of-contents__link">Service Mesh</a></li><li><a href="#step-1-prepare-the-kubernetes-cluster" class="table-of-contents__link">Step 1: Prepare the Kubernetes cluster</a></li><li><a href="#step-2-deploy-istio" class="table-of-contents__link">Step 2: Deploy Istio</a></li><li><a href="#step-3-deploy-apache-apisix" class="table-of-contents__link">Step 3: Deploy Apache APISIX</a></li><li><a href="#test-session" class="table-of-contents__link">Test Session</a><ul><li><a href="#simple-test" class="table-of-contents__link">Simple test</a></li><li><a href="#bookinfo-deployment-testing" class="table-of-contents__link">BookInfo Deployment Testing</a></li></ul></li><li><a href="#visualization-tool-kiali" class="table-of-contents__link">Visualization tool: Kiali</a></li><li><a href="#summary" class="table-of-contents__link">Summary</a></li></ul></div></div></div></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">ASF</div><ul class="footer__items"><li class="footer__item"><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Foundation</a></li><li class="footer__item"><a href="https://www.apache.org/licenses/" target="_blank" rel="noopener noreferrer" class="footer__link-item">License</a></li><li class="footer__item"><a href="https://www.apache.org/events/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Events</a></li><li class="footer__item"><a href="https://www.apache.org/security/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Security</a></li><li class="footer__item"><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Sponsorship</a></li><li class="footer__item"><a href="https://www.apache.org/foundation/thanks.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Thanks</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/apache/apisix/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Issue Tracker</a></li><li class="footer__item"><a href="https://apisix.apache.org/docs/general/community" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack</a></li><li class="footer__item"><a href="https://twitter.com/ApacheAPISIX" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://apisix.apache.org/blog/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="footerLogoLink_MyFc"><img src="/img/asf_logo_wide_small.png" alt="Apache Software Foundation" class="themedImage_1VuW themedImage--light_3UqQ footer__logo"><img src="/img/asf_logo_wide_small.png" alt="Apache Software Foundation" class="themedImage_1VuW themedImage--dark_hz6m footer__logo"></a></div><div class="footer__copyright">Copyright © 2019-2021 The Apache Software Foundation. Apache APISIX, APISIX®, Apache, the Apache feather logo, and the Apache APISIX project logo are either registered trademarks or trademarks of the Apache Software Foundation.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.29cc9d1a.js"></script>
<script src="/assets/js/main.41b511ad.js"></script>
</body>
<script>window.onload=function(){window.location.host.endsWith(".netlify.app")&&document.querySelector("#__docusaurus").insertAdjacentHTML("afterend",'<div style="text-align: right;padding: 48px 32px 48px 0;">This site is powered by <a href="https://www.netlify.com/" target="_blank">Netlify</a></div>')}</script>
</html>